<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      throwConfigExceptions="true">

  <!-- 变量定义 -->
  <variable name="logDirectory" value="${specialfolder:folder=LocalApplicationData}/The Untamed Music Player/Logs" />
  <variable name="logLayout" value="${longdate} [${level:uppercase=true:padding=5}] ${logger:shortName=true} ${message} ${exception:format=tostring}" />

  <!-- 目标配置 -->
  <targets async="true">
    <!-- 文件日志目标 -->
    <target xsi:type="File" 
            name="fileTarget"
            fileName="${logDirectory}/app-${shortdate}.log"
            layout="${logLayout}"
            maxArchiveFiles="7"
            archiveEvery="Day"
            archiveDateFormat="yyyyMMdd"
            keepFileOpen="true"
            autoFlush="false"
            openFileFlushTimeout="5"
            createDirs="true"
            bufferSize="32768"
            encoding="utf-8" />

    <!-- 错误文件日志目标（单独的错误日志文件） -->
    <target xsi:type="File" 
            name="errorFileTarget"
            fileName="${logDirectory}/error-${shortdate}.log"
            layout="${logLayout}"
            maxArchiveFiles="30"
            archiveEvery="Day"
            createDirs="true"
            encoding="utf-8" />

    <!-- 控制台目标（仅Debug模式） -->
    <target xsi:type="Console" 
            name="consoleTarget"
            layout="${time} [${level:uppercase=true:padding=5}] ${logger:shortName=true} ${message}" />

    <!-- 调试输出目标（仅Debug模式） -->
    <target xsi:type="Debugger" 
            name="debugTarget"
            layout="${time} [${level:uppercase=true:padding=5}] ${logger:shortName=true} ${message}" />

    <!-- 内存目标（用于InfoBar显示） -->
    <target xsi:type="Memory" 
            name="memoryTarget"
            layout="${message}" />
  </targets>

  <!-- 规则配置 -->
  <rules>
    <!-- 所有日志写入文件 -->
    <logger name="*" minlevel="Debug" writeTo="fileTarget" />
    
    <!-- Error及以上级别单独写入错误日志文件 -->
    <logger name="*" minlevel="Error" writeTo="errorFileTarget" />
    
    <!-- Error及以上级别写入内存目标（用于InfoBar显示） -->
    <logger name="*" minlevel="Error" writeTo="memoryTarget" />

    <!-- Debug模式下额外的输出 -->
    <logger name="*" minlevel="Debug" writeTo="consoleTarget" enabled="false" />
    <logger name="*" minlevel="Debug" writeTo="debugTarget" enabled="false" />
    
    <!-- 特定命名空间的日志级别控制 -->
    <!-- 例如：降低某些命名空间的日志级别 -->
    <!-- <logger name="System.*" maxlevel="Info" final="true" /> -->
    <!-- <logger name="Microsoft.*" maxlevel="Warn" final="true" /> -->
  </rules>
</nlog>